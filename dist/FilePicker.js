!function(e){function t(n){if(o[n])return o[n].exports;var i=o[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var o={};t.m=e,t.c=o,t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t){e.exports=React},function(e,t){},function(e,t,o){"use strict";function n(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}Object.defineProperty(t,"__esModule",{value:!0}),n(o(3)),n(o(4))},function(e,t,o){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=o(0);o(1);var r=function(e){function t(t){var o=e.call(this,t)||this;o.componentId="",o.flowKey="",o.attributes={},o.selectedItem=null,o.text="",o.componentId=t.id,o.flowKey=t.flowKey;var n=manywho.model.getComponent(o.props.id,o.props.flowKey);if(n.attributes)for(var i in n.attributes)o.attributes[i]=n.attributes[i];return o}return n(t,e),t.prototype.componentDidMount=function(){this.forceUpdate()},t.prototype.componentDidUpdate=function(){},t.prototype.getAttribute=function(e){return this.attributes[e]?this.attributes[e]:null},t.prototype.render=function(){var e,t=manywho.model.getComponent(this.componentId,this.flowKey),o=manywho.state.getComponent(this.componentId,this.flowKey),n=this.getAttribute("Title")||"Select File",r=t.width+"px",a=t.height+"px",l={};if(l.width=r,l.height=a,t.isEditable){e=this.pickFile.bind(this);var s=i.createElement("span",{className:"glyphicon glyphicon-remove file-box-header-button",onClick:this.clearFile.bind(this)})}return i.createElement("div",{className:"file-box",style:l},i.createElement("div",{className:"file-box-header"},i.createElement("div",{className:"file-box-header-left"},i.createElement("span",{className:"file-box-header-title"},n)),i.createElement("div",{className:"file-box-header-right"},s)),i.createElement("div",{className:"file-box-body",onClick:e},i.createElement("img",{ref:"img",className:"file-image",src:o.contentValue}),i.createElement("input",{ref:"file",type:"file",className:"file-file",onChange:this.fileSelected.bind(this)})))},t.prototype.clearFile=function(){this.refs.file},t.prototype.pickFile=function(){var e;e=this.refs.file,e.click()},t.prototype.fileSelected=function(){var e;if(e=this.refs.file,e.files&&e.files.length>0){var t=(manywho.model.getComponent(this.componentId,this.flowKey),manywho.state.getComponent(this.componentId,this.flowKey),this),o=new FileReader;o.onload=function(e){t.ResizeBase64Img(e.target.result,400)},o.readAsDataURL(e.files[0])}},t.prototype.ResizeBase64Img=function(e,t){var o=manywho.state.getComponent(this.componentId,this.flowKey),n=(manywho.model.getComponent(this.componentId,this.flowKey),new Image),i=this;n.onload=function(){var e=n.height/n.width,r=document.createElement("canvas");n.width;r.width=t,r.height=t*e;var a=r.getContext("2d");n.width;a.scale(r.width/n.width,r.height/n.height),a.drawImage(n,0,0);var l=r.toDataURL();o.contentValue=l,n.src=l,i.forceUpdate()},n.src=e},t}(i.Component);manywho.component.register("FilePicker",r),t.default=r},function(e,t,o){"use strict";var n=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=o(0);o(1);var r=function(e){function t(t){var o=e.call(this,t)||this;o.componentId="",o.flowKey="",o.attributes={},o.selectedItem=null,o.text="",o.componentId=t.id,o.flowKey=t.flowKey;var n=manywho.model.getComponent(o.props.id,o.props.flowKey);if(n.attributes)for(var i in n.attributes)o.attributes[i]=n.attributes[i];return o}return n(t,e),t.prototype.componentDidMount=function(){this.forceUpdate()},t.prototype.componentDidUpdate=function(){},t.prototype.getAttribute=function(e){return this.attributes[e]?this.attributes[e]:null},t.prototype.render=function(){var e,t=manywho.model.getComponent(this.componentId,this.flowKey),o=(manywho.state.getComponent(this.componentId,this.flowKey),this.getAttribute("Title")||"Select File"),n=t.width+"px",r=t.height+"px",a={};if(a.width=n,a.height=r,t.isEditable){e=this.pickFile.bind(this);var l=i.createElement("span",{className:"glyphicon glyphicon-remove file-box-header-button",onClick:this.clearFile.bind(this)})}return i.createElement("div",{className:"file-box",style:a},i.createElement("div",{className:"text-file-box-header"},i.createElement("div",{className:"file-box-header-left"},i.createElement("span",{className:"file-box-header-title"},o)),i.createElement("div",{className:"file-box-header-right"},l)),i.createElement("div",{className:"text-file-box-body",onClick:e},i.createElement("span",{ref:"fname",className:"file-name"},this.selectedItem),i.createElement("input",{ref:"file",type:"file",className:"file-file",onChange:this.fileSelected.bind(this)})))},t.prototype.clearFile=function(){this.refs.file},t.prototype.pickFile=function(){var e;e=this.refs.file,e.click()},t.prototype.fileSelected=function(){var e;if(e=this.refs.file,e.files&&e.files.length>0){var t=(manywho.model.getComponent(this.componentId,this.flowKey),manywho.state.getComponent(this.componentId,this.flowKey)),o=new FileReader;o.onload=function(e){var o=btoa(e.target.result);t.contentValue=o},this.selectedItem=e.files[0].name,this.forceUpdate(),o.readAsBinaryString(e.files[0])}},t}(i.Component);manywho.component.register("TextFilePicker",r),t.default=r}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vRmlsZVBpY2tlci5qcyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgMzM4NzM4ODUzOTNjODFhZGFhMTEiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiUmVhY3RcIiIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXgudHN4Iiwid2VicGFjazovLy8uL3NyYy9GaWxlUGlja2VyLnRzeCIsIndlYnBhY2s6Ly8vLi9zcmMvVGV4dEZpbGVQaWNrZXIudHN4Il0sIm5hbWVzIjpbIm1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJpbnN0YWxsZWRNb2R1bGVzIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJlbnVtZXJhYmxlIiwiZ2V0IiwibiIsIl9fZXNNb2R1bGUiLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJSZWFjdCIsIl9fZXhwb3J0IiwidmFsdWUiLCJfX2V4dGVuZHMiLCJ0aGlzIiwiZXh0ZW5kU3RhdGljcyIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiQXJyYXkiLCJiIiwiX18iLCJjb25zdHJ1Y3RvciIsImNyZWF0ZSIsIkZpbGVQaWNrZXIiLCJfc3VwZXIiLCJwcm9wcyIsIl90aGlzIiwiY29tcG9uZW50SWQiLCJmbG93S2V5IiwiYXR0cmlidXRlcyIsInNlbGVjdGVkSXRlbSIsInRleHQiLCJpZCIsImZsb3dNb2RlbCIsIm1hbnl3aG8iLCJtb2RlbCIsImdldENvbXBvbmVudCIsImtleSIsImNvbXBvbmVudERpZE1vdW50IiwiZm9yY2VVcGRhdGUiLCJjb21wb25lbnREaWRVcGRhdGUiLCJnZXRBdHRyaWJ1dGUiLCJhdHRyaWJ1dGVOYW1lIiwicmVuZGVyIiwiZmlsZVBpY2siLCJmbG93U3RhdGUiLCJzdGF0ZSIsImNhcHRpb24iLCJ3aWR0aCIsImhlaWdodCIsInN0eWxlIiwiaXNFZGl0YWJsZSIsInBpY2tGaWxlIiwiYmluZCIsImNsZWFyQnV0dG9uIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZSIsIm9uQ2xpY2siLCJjbGVhckZpbGUiLCJyZWYiLCJzcmMiLCJjb250ZW50VmFsdWUiLCJ0eXBlIiwib25DaGFuZ2UiLCJmaWxlU2VsZWN0ZWQiLCJyZWZzIiwiZmlsZSIsImNsaWNrIiwiZmlsZXMiLCJsZW5ndGgiLCJhYV8xIiwicmVhZGVyIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsImUiLCJSZXNpemVCYXNlNjRJbWciLCJ0YXJnZXQiLCJyZXN1bHQiLCJyZWFkQXNEYXRhVVJMIiwiYmFzZTY0IiwiaW1nIiwiSW1hZ2UiLCJhc3BlY3RSYXRpbyIsImNhbnZhcyIsImRvY3VtZW50IiwiY29udGV4dCIsImdldENvbnRleHQiLCJzY2FsZSIsImRyYXdJbWFnZSIsInJlc2l6ZWQiLCJ0b0RhdGFVUkwiLCJDb21wb25lbnQiLCJjb21wb25lbnQiLCJyZWdpc3RlciIsImRlZmF1bHQiLCJUZXh0RmlsZVBpY2tlciIsImZsb3dTdGF0ZV8xIiwiZmlsZURhdGEiLCJidG9hIiwicmVhZEFzQmluYXJ5U3RyaW5nIl0sIm1hcHBpbmdzIjoiQ0FBUyxTQUFVQSxHQ0luQixRQUFBQyxHQUFBQyxHQUdBLEdBQUFDLEVBQUFELEdBQ0EsTUFBQUMsR0FBQUQsR0FBQUUsT0FHQSxJQUFBQyxHQUFBRixFQUFBRCxJQUNBSSxFQUFBSixFQUNBSyxHQUFBLEVBQ0FILFdBVUEsT0FOQUosR0FBQUUsR0FBQU0sS0FBQUgsRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUgsR0FHQUksRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQXZCQSxHQUFBRCxLQTRCQUYsR0FBQVEsRUFBQVQsRUFHQUMsRUFBQVMsRUFBQVAsRUFHQUYsRUFBQVUsRUFBQSxTQUFBUCxFQUFBUSxFQUFBQyxHQUNBWixFQUFBYSxFQUFBVixFQUFB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QSxFQUFPcEQsS0FBS21ELEtBQUtDLEtBRWRBLEVBQUtFLE9BQVNGLEVBQUtFLE1BQU1DLE9BQVMsRUFDckMsQ0FDSSxHQUNNMkIsSUFEWTlELFFBQVFDLE1BQU1DLGFBQWF0QixLQUFLYSxZQUFlYixLQUFLYyxTQUNwRE0sUUFBUVksTUFBTVYsYUFBYXRCLEtBQUthLFlBQWViLEtBQUtjLFVBSWxFMkMsRUFBUyxHQUFJQyxXQUNqQkQsR0FBT0UsT0FBUyxTQUFVQyxHQUV0QixHQUFJdUIsR0FBV0MsS0FBS3hCLEVBQUVFLE9BQU9DLE9BQzdCbUIsR0FBVW5DLGFBQWVvQyxHQUU3Qm5GLEtBQUtnQixhQUFlb0MsRUFBS0UsTUFBTSxHQUFHMUUsS0FDbENvQixLQUFLeUIsY0FDTGdDLEVBQU80QixtQkFBbUJqQyxFQUFLRSxNQUFNLE1BS2pEMkIsR0EvSDZCckYsRUFBTWlGLFVBaUluQ3pELFNBQVEwRCxVQUFVQyxTQUFTLGlCQUFrQkUsR0FFN0M3RyxFQUFBNEcsUUFBZUMiLCJmaWxlIjoiRmlsZVBpY2tlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKiovIChmdW5jdGlvbihtb2R1bGVzKSB7IC8vIHdlYnBhY2tCb290c3RyYXBcbi8qKioqKiovIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbi8qKioqKiovIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbi8qKioqKiovIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuLyoqKioqKi8gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4vKioqKioqLyBcdFx0fVxuLyoqKioqKi8gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4vKioqKioqLyBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuLyoqKioqKi8gXHRcdFx0aTogbW9kdWxlSWQsXG4vKioqKioqLyBcdFx0XHRsOiBmYWxzZSxcbi8qKioqKiovIFx0XHRcdGV4cG9ydHM6IHt9XG4vKioqKioqLyBcdFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4vKioqKioqLyBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbi8qKioqKiovIFx0XHRtb2R1bGUubCA9IHRydWU7XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4vKioqKioqLyBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuLyoqKioqKi8gXHR9XG4vKioqKioqL1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4vKioqKioqLyBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuLyoqKioqKi8gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbi8qKioqKiovIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbi8qKioqKiovIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbi8qKioqKiovIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbi8qKioqKiovIFx0XHRcdH0pO1xuLyoqKioqKi8gXHRcdH1cbi8qKioqKiovIFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuLyoqKioqKi8gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuLyoqKioqKi8gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbi8qKioqKiovIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4vKioqKioqLyBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuLyoqKioqKi8gXHRcdHJldHVybiBnZXR0ZXI7XG4vKioqKioqLyBcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLyoqKioqKi8gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAyKTtcbi8qKioqKiovIH0pXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqKioqKi8gKFtcbi8qIDAgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdDtcblxuLyoqKi8gfSksXG4vKiAxICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzKSB7XG5cbi8vIHJlbW92ZWQgYnkgZXh0cmFjdC10ZXh0LXdlYnBhY2stcGx1Z2luXG5cbi8qKiovIH0pLFxuLyogMiAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxyXG5mdW5jdGlvbiBfX2V4cG9ydChtKSB7XHJcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmICghZXhwb3J0cy5oYXNPd25Qcm9wZXJ0eShwKSkgZXhwb3J0c1twXSA9IG1bcF07XHJcbn1cclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5fX2V4cG9ydChfX3dlYnBhY2tfcmVxdWlyZV9fKDMpKTtcclxuX19leHBvcnQoX193ZWJwYWNrX3JlcXVpcmVfXyg0KSk7XHJcblxuXG4vKioqLyB9KSxcbi8qIDMgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cclxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxuICAgIH07XHJcbn0pKCk7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxudmFyIFJlYWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcclxuX193ZWJwYWNrX3JlcXVpcmVfXygxKTtcclxudmFyIEZpbGVQaWNrZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoRmlsZVBpY2tlciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEZpbGVQaWNrZXIocHJvcHMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwcm9wcykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5jb21wb25lbnRJZCA9IFwiXCI7XHJcbiAgICAgICAgX3RoaXMuZmxvd0tleSA9IFwiXCI7XHJcbiAgICAgICAgX3RoaXMuYXR0cmlidXRlcyA9IHt9O1xyXG4gICAgICAgIF90aGlzLnNlbGVjdGVkSXRlbSA9IG51bGw7XHJcbiAgICAgICAgX3RoaXMudGV4dCA9IFwiXCI7XHJcbiAgICAgICAgX3RoaXMuY29tcG9uZW50SWQgPSBwcm9wcy5pZDtcclxuICAgICAgICBfdGhpcy5mbG93S2V5ID0gcHJvcHMuZmxvd0tleTtcclxuICAgICAgICAvL3B1c2ggYXR0cmlidXRlcyBpbnRvIGtleWVkIG1hcCBcclxuICAgICAgICB2YXIgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQoX3RoaXMucHJvcHMuaWQsIF90aGlzLnByb3BzLmZsb3dLZXkpO1xyXG4gICAgICAgIGlmIChmbG93TW9kZWwuYXR0cmlidXRlcykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gZmxvd01vZGVsLmF0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJpYnV0ZXNba2V5XSA9IGZsb3dNb2RlbC5hdHRyaWJ1dGVzW2tleV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgRmlsZVBpY2tlci5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5mb3JjZVVwZGF0ZSgpO1xyXG4gICAgfTtcclxuICAgIEZpbGVQaWNrZXIucHJvdG90eXBlLmNvbXBvbmVudERpZFVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIH07XHJcbiAgICBGaWxlUGlja2VyLnByb3RvdHlwZS5nZXRBdHRyaWJ1dGUgPSBmdW5jdGlvbiAoYXR0cmlidXRlTmFtZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmF0dHJpYnV0ZXNbYXR0cmlidXRlTmFtZV0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBGaWxlUGlja2VyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIGZsb3dTdGF0ZSA9IG1hbnl3aG8uc3RhdGUuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIGZpbGVQaWNrO1xyXG4gICAgICAgIHZhciBjYXB0aW9uID0gdGhpcy5nZXRBdHRyaWJ1dGUoXCJUaXRsZVwiKSB8fCBcIlNlbGVjdCBGaWxlXCI7XHJcbiAgICAgICAgdmFyIHdpZHRoID0gZmxvd01vZGVsLndpZHRoICsgXCJweFwiO1xyXG4gICAgICAgIHZhciBoZWlnaHQgPSBmbG93TW9kZWwuaGVpZ2h0ICsgXCJweFwiO1xyXG4gICAgICAgIHZhciBzdHlsZSA9IHt9O1xyXG4gICAgICAgIHN0eWxlLndpZHRoID0gd2lkdGg7XHJcbiAgICAgICAgc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0O1xyXG4gICAgICAgIGlmIChmbG93TW9kZWwuaXNFZGl0YWJsZSkge1xyXG4gICAgICAgICAgICBmaWxlUGljayA9IHRoaXMucGlja0ZpbGUuYmluZCh0aGlzKTtcclxuICAgICAgICAgICAgdmFyIGNsZWFyQnV0dG9uID0gUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwiZ2x5cGhpY29uIGdseXBoaWNvbi1yZW1vdmUgZmlsZS1ib3gtaGVhZGVyLWJ1dHRvblwiLCBvbkNsaWNrOiB0aGlzLmNsZWFyRmlsZS5iaW5kKHRoaXMpIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJmaWxlLWJveFwiLCBzdHlsZTogc3R5bGUgfSxcclxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJmaWxlLWJveC1oZWFkZXJcIiB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJmaWxlLWJveC1oZWFkZXItbGVmdFwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwiZmlsZS1ib3gtaGVhZGVyLXRpdGxlXCIgfSwgY2FwdGlvbikpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJmaWxlLWJveC1oZWFkZXItcmlnaHRcIiB9LCBjbGVhckJ1dHRvbikpLFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImZpbGUtYm94LWJvZHlcIiwgb25DbGljazogZmlsZVBpY2sgfSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIiwgeyByZWY6IFwiaW1nXCIsIGNsYXNzTmFtZTogXCJmaWxlLWltYWdlXCIsIHNyYzogZmxvd1N0YXRlLmNvbnRlbnRWYWx1ZSB9KSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiLCB7IHJlZjogXCJmaWxlXCIsIHR5cGU6IFwiZmlsZVwiLCBjbGFzc05hbWU6IFwiZmlsZS1maWxlXCIsIG9uQ2hhbmdlOiB0aGlzLmZpbGVTZWxlY3RlZC5iaW5kKHRoaXMpIH0pKSk7XHJcbiAgICB9O1xyXG4gICAgRmlsZVBpY2tlci5wcm90b3R5cGUuY2xlYXJGaWxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBmaWxlO1xyXG4gICAgICAgIGZpbGUgPSB0aGlzLnJlZnMuZmlsZTtcclxuICAgIH07XHJcbiAgICBGaWxlUGlja2VyLnByb3RvdHlwZS5waWNrRmlsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZmlsZTtcclxuICAgICAgICBmaWxlID0gdGhpcy5yZWZzLmZpbGU7XHJcbiAgICAgICAgZmlsZS5jbGljaygpO1xyXG4gICAgfTtcclxuICAgIEZpbGVQaWNrZXIucHJvdG90eXBlLmZpbGVTZWxlY3RlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZmlsZTtcclxuICAgICAgICBmaWxlID0gdGhpcy5yZWZzLmZpbGU7XHJcbiAgICAgICAgaWYgKGZpbGUuZmlsZXMgJiYgZmlsZS5maWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgICAgICB2YXIgZmxvd1N0YXRlID0gbWFueXdoby5zdGF0ZS5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICAgICAgdmFyIGFhXzEgPSB0aGlzO1xyXG4gICAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzaXplZCA9IGFhXzEuUmVzaXplQmFzZTY0SW1nKGUudGFyZ2V0LnJlc3VsdCwgNDAwKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZS5maWxlc1swXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEZpbGVQaWNrZXIucHJvdG90eXBlLlJlc2l6ZUJhc2U2NEltZyA9IGZ1bmN0aW9uIChiYXNlNjQsIHdpZHRoKSB7XHJcbiAgICAgICAgdmFyIGZsb3dTdGF0ZSA9IG1hbnl3aG8uc3RhdGUuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xyXG4gICAgICAgIHZhciBzdGF0ZSA9IHRoaXM7XHJcbiAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGFzcGVjdFJhdGlvID0gaW1nLmhlaWdodCAvIGltZy53aWR0aDtcclxuICAgICAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XHJcbiAgICAgICAgICAgIHZhciByZWR1Y3Rpb25GYWN0b3IgPSB3aWR0aCAvIGltZy53aWR0aDtcclxuICAgICAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7XHJcbiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSB3aWR0aCAqIGFzcGVjdFJhdGlvO1xyXG4gICAgICAgICAgICB2YXIgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcbiAgICAgICAgICAgIHZhciByZWR1Y3Rpb25GYWN0b3IgPSB3aWR0aCAvIGltZy53aWR0aDtcclxuICAgICAgICAgICAgY29udGV4dC5zY2FsZShjYW52YXMud2lkdGggLyBpbWcud2lkdGgsIGNhbnZhcy5oZWlnaHQgLyBpbWcuaGVpZ2h0KTtcclxuICAgICAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcclxuICAgICAgICAgICAgdmFyIHJlc2l6ZWQgPSBjYW52YXMudG9EYXRhVVJMKCk7XHJcbiAgICAgICAgICAgIGZsb3dTdGF0ZS5jb250ZW50VmFsdWUgPSByZXNpemVkO1xyXG4gICAgICAgICAgICBpbWcuc3JjID0gcmVzaXplZDtcclxuICAgICAgICAgICAgc3RhdGUuZm9yY2VVcGRhdGUoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGltZy5zcmMgPSBiYXNlNjQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEZpbGVQaWNrZXI7XHJcbn0oUmVhY3QuQ29tcG9uZW50KSk7XHJcbm1hbnl3aG8uY29tcG9uZW50LnJlZ2lzdGVyKCdGaWxlUGlja2VyJywgRmlsZVBpY2tlcik7XHJcbmV4cG9ydHMuZGVmYXVsdCA9IEZpbGVQaWNrZXI7XHJcblxuXG4vKioqLyB9KSxcbi8qIDQgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cclxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxuICAgIH07XHJcbn0pKCk7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxudmFyIFJlYWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcclxuX193ZWJwYWNrX3JlcXVpcmVfXygxKTtcclxudmFyIFRleHRGaWxlUGlja2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFRleHRGaWxlUGlja2VyLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gVGV4dEZpbGVQaWNrZXIocHJvcHMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwcm9wcykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5jb21wb25lbnRJZCA9IFwiXCI7XHJcbiAgICAgICAgX3RoaXMuZmxvd0tleSA9IFwiXCI7XHJcbiAgICAgICAgX3RoaXMuYXR0cmlidXRlcyA9IHt9O1xyXG4gICAgICAgIF90aGlzLnNlbGVjdGVkSXRlbSA9IG51bGw7XHJcbiAgICAgICAgX3RoaXMudGV4dCA9IFwiXCI7XHJcbiAgICAgICAgX3RoaXMuY29tcG9uZW50SWQgPSBwcm9wcy5pZDtcclxuICAgICAgICBfdGhpcy5mbG93S2V5ID0gcHJvcHMuZmxvd0tleTtcclxuICAgICAgICAvL3B1c2ggYXR0cmlidXRlcyBpbnRvIGtleWVkIG1hcCBcclxuICAgICAgICB2YXIgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQoX3RoaXMucHJvcHMuaWQsIF90aGlzLnByb3BzLmZsb3dLZXkpO1xyXG4gICAgICAgIGlmIChmbG93TW9kZWwuYXR0cmlidXRlcykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gZmxvd01vZGVsLmF0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmF0dHJpYnV0ZXNba2V5XSA9IGZsb3dNb2RlbC5hdHRyaWJ1dGVzW2tleV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgVGV4dEZpbGVQaWNrZXIucHJvdG90eXBlLmNvbXBvbmVudERpZE1vdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgIH07XHJcbiAgICBUZXh0RmlsZVBpY2tlci5wcm90b3R5cGUuY29tcG9uZW50RGlkVXBkYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgfTtcclxuICAgIFRleHRGaWxlUGlja2VyLnByb3RvdHlwZS5nZXRBdHRyaWJ1dGUgPSBmdW5jdGlvbiAoYXR0cmlidXRlTmFtZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmF0dHJpYnV0ZXNbYXR0cmlidXRlTmFtZV0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBUZXh0RmlsZVBpY2tlci5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIHZhciBmbG93U3RhdGUgPSBtYW55d2hvLnN0YXRlLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIHZhciBmaWxlUGljaztcclxuICAgICAgICB2YXIgY2FwdGlvbiA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiVGl0bGVcIikgfHwgXCJTZWxlY3QgRmlsZVwiO1xyXG4gICAgICAgIHZhciB3aWR0aCA9IGZsb3dNb2RlbC53aWR0aCArIFwicHhcIjtcclxuICAgICAgICB2YXIgaGVpZ2h0ID0gZmxvd01vZGVsLmhlaWdodCArIFwicHhcIjtcclxuICAgICAgICB2YXIgc3R5bGUgPSB7fTtcclxuICAgICAgICBzdHlsZS53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgIHN0eWxlLmhlaWdodCA9IGhlaWdodDtcclxuICAgICAgICBpZiAoZmxvd01vZGVsLmlzRWRpdGFibGUpIHtcclxuICAgICAgICAgICAgZmlsZVBpY2sgPSB0aGlzLnBpY2tGaWxlLmJpbmQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBjbGVhckJ1dHRvbiA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcImdseXBoaWNvbiBnbHlwaGljb24tcmVtb3ZlIGZpbGUtYm94LWhlYWRlci1idXR0b25cIiwgb25DbGljazogdGhpcy5jbGVhckZpbGUuYmluZCh0aGlzKSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwiZmlsZS1ib3hcIiwgc3R5bGU6IHN0eWxlIH0sXHJcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwidGV4dC1maWxlLWJveC1oZWFkZXJcIiB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJmaWxlLWJveC1oZWFkZXItbGVmdFwiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwiZmlsZS1ib3gtaGVhZGVyLXRpdGxlXCIgfSwgY2FwdGlvbikpLFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJmaWxlLWJveC1oZWFkZXItcmlnaHRcIiB9LCBjbGVhckJ1dHRvbikpLFxyXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInRleHQtZmlsZS1ib3gtYm9keVwiLCBvbkNsaWNrOiBmaWxlUGljayB9LFxyXG4gICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcInNwYW5cIiwgeyByZWY6IFwiZm5hbWVcIiwgY2xhc3NOYW1lOiBcImZpbGUtbmFtZVwiIH0sIHRoaXMuc2VsZWN0ZWRJdGVtKSxcclxuICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiLCB7IHJlZjogXCJmaWxlXCIsIHR5cGU6IFwiZmlsZVwiLCBjbGFzc05hbWU6IFwiZmlsZS1maWxlXCIsIG9uQ2hhbmdlOiB0aGlzLmZpbGVTZWxlY3RlZC5iaW5kKHRoaXMpIH0pKSk7XHJcbiAgICB9O1xyXG4gICAgVGV4dEZpbGVQaWNrZXIucHJvdG90eXBlLmNsZWFyRmlsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZmlsZTtcclxuICAgICAgICBmaWxlID0gdGhpcy5yZWZzLmZpbGU7XHJcbiAgICB9O1xyXG4gICAgVGV4dEZpbGVQaWNrZXIucHJvdG90eXBlLnBpY2tGaWxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBmaWxlO1xyXG4gICAgICAgIGZpbGUgPSB0aGlzLnJlZnMuZmlsZTtcclxuICAgICAgICBmaWxlLmNsaWNrKCk7XHJcbiAgICB9O1xyXG4gICAgVGV4dEZpbGVQaWNrZXIucHJvdG90eXBlLmZpbGVTZWxlY3RlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZmlsZTtcclxuICAgICAgICBmaWxlID0gdGhpcy5yZWZzLmZpbGU7XHJcbiAgICAgICAgaWYgKGZpbGUuZmlsZXMgJiYgZmlsZS5maWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHZhciBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgICAgICB2YXIgZmxvd1N0YXRlXzEgPSBtYW55d2hvLnN0YXRlLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgICAgICB2YXIgYWEgPSB0aGlzO1xyXG4gICAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZmlsZURhdGEgPSBidG9hKGUudGFyZ2V0LnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICBmbG93U3RhdGVfMS5jb250ZW50VmFsdWUgPSBmaWxlRGF0YTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW0gPSBmaWxlLmZpbGVzWzBdLm5hbWU7XHJcbiAgICAgICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlLmZpbGVzWzBdKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFRleHRGaWxlUGlja2VyO1xyXG59KFJlYWN0LkNvbXBvbmVudCkpO1xyXG5tYW55d2hvLmNvbXBvbmVudC5yZWdpc3RlcignVGV4dEZpbGVQaWNrZXInLCBUZXh0RmlsZVBpY2tlcik7XHJcbmV4cG9ydHMuZGVmYXVsdCA9IFRleHRGaWxlUGlja2VyO1xyXG5cblxuLyoqKi8gfSlcbi8qKioqKiovIF0pO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBGaWxlUGlja2VyLmpzIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMik7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicGFjay9ib290c3RyYXAgMzM4NzM4ODUzOTNjODFhZGFhMTEiLCJtb2R1bGUuZXhwb3J0cyA9IFJlYWN0O1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIGV4dGVybmFsIFwiUmVhY3RcIlxuLy8gbW9kdWxlIGlkID0gMFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJleHBvcnQgKiBmcm9tICcuL0ZpbGVQaWNrZXInO1xuZXhwb3J0ICogZnJvbSAnLi9UZXh0RmlsZVBpY2tlcic7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvaW5kZXgudHN4IiwiXHJcbmRlY2xhcmUgdmFyIG1hbnl3aG86IGFueTtcclxuXHJcbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcclxuaW1wb3J0ICcuL0ZpbGVQaWNrZXIuY3NzJztcclxuXHJcbmNsYXNzIEZpbGVQaWNrZXIgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8YW55LCBhbnk+IFxyXG57ICAgXHJcbiAgICBjb21wb25lbnRJZDogc3RyaW5nID0gXCJcIjtcclxuICAgIGZsb3dLZXk6IHN0cmluZyA9XCJcIjsgICAgXHJcbiAgICBhdHRyaWJ1dGVzIDogYW55ID0ge307XHJcbiAgICBzZWxlY3RlZEl0ZW06IHN0cmluZyA9IG51bGw7XHJcblxyXG4gICAgdGV4dCA6IHN0cmluZyA9IFwiXCI7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJvcHMgOiBhbnkpXHJcblx0e1xyXG4gICAgICAgIHN1cGVyKHByb3BzKTtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmNvbXBvbmVudElkID0gcHJvcHMuaWQ7XHJcbiAgICAgICAgdGhpcy5mbG93S2V5ID0gcHJvcHMuZmxvd0tleTtcclxuXHJcbiAgICAgICAgLy9wdXNoIGF0dHJpYnV0ZXMgaW50byBrZXllZCBtYXAgXHJcblx0XHR2YXIgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5wcm9wcy5pZCwgICB0aGlzLnByb3BzLmZsb3dLZXkpO1xyXG5cdFx0aWYoZmxvd01vZGVsLmF0dHJpYnV0ZXMpXHJcblx0XHR7XHJcblx0XHRcdGZvcih2YXIga2V5IGluIGZsb3dNb2RlbC5hdHRyaWJ1dGVzKVxyXG5cdFx0XHR7XHJcblx0XHRcdFx0dGhpcy5hdHRyaWJ1dGVzW2tleV0gPSBmbG93TW9kZWwuYXR0cmlidXRlc1trZXldO1xyXG5cdFx0XHR9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSBcclxuICAgIHtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29tcG9uZW50RGlkVXBkYXRlKClcclxuICAgIHtcclxuXHJcbiAgICB9XHJcblxyXG5cdGdldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lIDogc3RyaW5nKVxyXG5cdHtcclxuXHRcdGlmKHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXSlcclxuXHRcdHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXTtcclxuXHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuICAgICAgIFxyXG4gICAgcmVuZGVyKClcclxuICAgIHtcclxuICAgICAgICBjb25zdCBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCAgIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgY29uc3QgZmxvd1N0YXRlID0gbWFueXdoby5zdGF0ZS5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgICB0aGlzLmZsb3dLZXkpO1xyXG5cclxuICAgICAgICB2YXIgZmlsZVBpY2sgOiBhbnk7XHJcbiAgICAgICAgdmFyIGNhcHRpb24gOiBzdHJpbmcgPSB0aGlzLmdldEF0dHJpYnV0ZShcIlRpdGxlXCIpIHx8IFwiU2VsZWN0IEZpbGVcIjtcclxuICAgICAgICB2YXIgd2lkdGggPSBmbG93TW9kZWwud2lkdGggKyBcInB4XCI7XHJcbiAgICAgICAgdmFyIGhlaWdodD1mbG93TW9kZWwuaGVpZ2h0ICsgXCJweFwiO1xyXG5cclxuICAgICAgICB2YXIgc3R5bGUgOiBhbnkgPSB7fTtcclxuICAgICAgICBzdHlsZS53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgIHN0eWxlLmhlaWdodCA9IGhlaWdodDtcclxuXHJcbiAgICAgICAgaWYoZmxvd01vZGVsLmlzRWRpdGFibGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmaWxlUGljayA9IHRoaXMucGlja0ZpbGUuYmluZCh0aGlzKTtcclxuICAgICAgICAgICAgdmFyIGNsZWFyQnV0dG9uID0gPHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1yZW1vdmUgZmlsZS1ib3gtaGVhZGVyLWJ1dHRvblwiIG9uQ2xpY2s9e3RoaXMuY2xlYXJGaWxlLmJpbmQodGhpcyl9Pjwvc3Bhbj47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJmaWxlLWJveFwiIHN0eWxlPXtzdHlsZX0gPlxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmlsZS1ib3gtaGVhZGVyXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmlsZS1ib3gtaGVhZGVyLWxlZnRcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImZpbGUtYm94LWhlYWRlci10aXRsZVwiPntjYXB0aW9ufTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmlsZS1ib3gtaGVhZGVyLXJpZ2h0XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Y2xlYXJCdXR0b259XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZpbGUtYm94LWJvZHlcIiBvbkNsaWNrPXtmaWxlUGlja30+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxpbWcgcmVmPVwiaW1nXCIgY2xhc3NOYW1lPVwiZmlsZS1pbWFnZVwiIHNyYz17Zmxvd1N0YXRlLmNvbnRlbnRWYWx1ZX0+PC9pbWc+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCByZWY9XCJmaWxlXCIgdHlwZT1cImZpbGVcIiBjbGFzc05hbWU9XCJmaWxlLWZpbGVcIiBvbkNoYW5nZT17dGhpcy5maWxlU2VsZWN0ZWQuYmluZCh0aGlzKX0+PC9pbnB1dD5cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJGaWxlKClcclxuICAgIHtcclxuICAgICAgICB2YXIgZmlsZSA6IGFueTtcclxuICAgICAgICBmaWxlID0gdGhpcy5yZWZzLmZpbGU7XHJcblxyXG4gICAgfVxyXG4gICAgcGlja0ZpbGUoKVxyXG4gICAge1xyXG4gICAgICAgIHZhciBmaWxlIDogYW55O1xyXG4gICAgICAgIGZpbGUgPSB0aGlzLnJlZnMuZmlsZTtcclxuICAgICAgICBmaWxlLmNsaWNrKCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZpbGVTZWxlY3RlZCgpXHJcbiAgICB7XHJcbiAgICAgICAgdmFyIGZpbGUgOiBhbnk7XHJcbiAgICAgICAgZmlsZSA9IHRoaXMucmVmcy5maWxlO1xyXG5cclxuICAgICAgICBpZihmaWxlLmZpbGVzICYmIGZpbGUuZmlsZXMubGVuZ3RoID4gMClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsICAgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICAgICAgY29uc3QgZmxvd1N0YXRlID0gbWFueXdoby5zdGF0ZS5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgICB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgICAgICBjb25zdCBhYSA9IHRoaXM7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSA6IGFueSkgXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXNpemVkID0gYWEuUmVzaXplQmFzZTY0SW1nKGUudGFyZ2V0LnJlc3VsdCw0MDApO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZS5maWxlc1swXSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBSZXNpemVCYXNlNjRJbWcoYmFzZTY0IDogc3RyaW5nLCB3aWR0aCA6IG51bWJlcikgXHJcbiAgICB7XHJcbiAgICAgICAgY29uc3QgZmxvd1N0YXRlID0gbWFueXdoby5zdGF0ZS5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgICB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgIGNvbnN0IGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsICAgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XHJcbiAgICAgICAgdmFyIHN0YXRlIDogYW55ID10aGlzO1xyXG4gICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIGFzcGVjdFJhdGlvID0gaW1nLmhlaWdodCAvaW1nLndpZHRoO1xyXG4gICAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciByZWR1Y3Rpb25GYWN0b3IgPSB3aWR0aCAvIGltZy53aWR0aDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gd2lkdGggKiBhc3BlY3RSYXRpbztcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuXHJcbiAgICAgICAgICAgIHZhciByZWR1Y3Rpb25GYWN0b3IgPSB3aWR0aCAvIGltZy53aWR0aDtcclxuICAgICAgICAgICAgY29udGV4dC5zY2FsZShjYW52YXMud2lkdGgvaW1nLndpZHRoICwgY2FudmFzLmhlaWdodCAvIGltZy5oZWlnaHQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWcsIDAgLCAwKTtcclxuICAgICAgICAgICAgdmFyIHJlc2l6ZWQgPSBjYW52YXMudG9EYXRhVVJMKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmbG93U3RhdGUuY29udGVudFZhbHVlID0gcmVzaXplZDtcclxuICAgICAgICAgICAgaW1nLnNyYyA9IHJlc2l6ZWQ7XHJcbiAgICAgICAgICAgIHN0YXRlLmZvcmNlVXBkYXRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGltZy5zcmMgPSBiYXNlNjQ7XHJcbiAgICB9XHJcbn1cclxuXHJcbm1hbnl3aG8uY29tcG9uZW50LnJlZ2lzdGVyKCdGaWxlUGlja2VyJywgRmlsZVBpY2tlcik7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBGaWxlUGlja2VyO1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9GaWxlUGlja2VyLnRzeCIsIlxyXG5kZWNsYXJlIHZhciBtYW55d2hvOiBhbnk7XHJcblxyXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCAnLi9GaWxlUGlja2VyLmNzcyc7XHJcblxyXG5jbGFzcyBUZXh0RmlsZVBpY2tlciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxhbnksIGFueT4gXHJcbnsgICBcclxuICAgIGNvbXBvbmVudElkOiBzdHJpbmcgPSBcIlwiO1xyXG4gICAgZmxvd0tleTogc3RyaW5nID1cIlwiOyAgICBcclxuICAgIGF0dHJpYnV0ZXMgOiBhbnkgPSB7fTtcclxuICAgIHNlbGVjdGVkSXRlbTogc3RyaW5nID0gbnVsbDtcclxuXHJcblxyXG4gICAgdGV4dCA6IHN0cmluZyA9IFwiXCI7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJvcHMgOiBhbnkpXHJcblx0e1xyXG4gICAgICAgIHN1cGVyKHByb3BzKTtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLmNvbXBvbmVudElkID0gcHJvcHMuaWQ7XHJcbiAgICAgICAgdGhpcy5mbG93S2V5ID0gcHJvcHMuZmxvd0tleTtcclxuXHJcbiAgICAgICAgLy9wdXNoIGF0dHJpYnV0ZXMgaW50byBrZXllZCBtYXAgXHJcblx0XHR2YXIgZmxvd01vZGVsID0gbWFueXdoby5tb2RlbC5nZXRDb21wb25lbnQodGhpcy5wcm9wcy5pZCwgICB0aGlzLnByb3BzLmZsb3dLZXkpO1xyXG5cdFx0aWYoZmxvd01vZGVsLmF0dHJpYnV0ZXMpXHJcblx0XHR7XHJcblx0XHRcdGZvcih2YXIga2V5IGluIGZsb3dNb2RlbC5hdHRyaWJ1dGVzKVxyXG5cdFx0XHR7XHJcblx0XHRcdFx0dGhpcy5hdHRyaWJ1dGVzW2tleV0gPSBmbG93TW9kZWwuYXR0cmlidXRlc1trZXldO1xyXG5cdFx0XHR9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSBcclxuICAgIHtcclxuICAgICAgICB0aGlzLmZvcmNlVXBkYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29tcG9uZW50RGlkVXBkYXRlKClcclxuICAgIHtcclxuXHJcbiAgICB9XHJcblxyXG5cdGdldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lIDogc3RyaW5nKVxyXG5cdHtcclxuXHRcdGlmKHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXSlcclxuXHRcdHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVOYW1lXTtcclxuXHRcdH1cclxuXHRcdGVsc2VcclxuXHRcdHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuICAgICAgIFxyXG4gICAgcmVuZGVyKClcclxuICAgIHtcclxuICAgICAgICBjb25zdCBmbG93TW9kZWwgPSBtYW55d2hvLm1vZGVsLmdldENvbXBvbmVudCh0aGlzLmNvbXBvbmVudElkLCAgIHRoaXMuZmxvd0tleSk7XHJcbiAgICAgICAgY29uc3QgZmxvd1N0YXRlID0gbWFueXdoby5zdGF0ZS5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgICB0aGlzLmZsb3dLZXkpO1xyXG5cclxuICAgICAgICB2YXIgZmlsZVBpY2sgOiBhbnk7XHJcbiAgICAgICAgdmFyIGNhcHRpb24gOiBzdHJpbmcgPSB0aGlzLmdldEF0dHJpYnV0ZShcIlRpdGxlXCIpIHx8IFwiU2VsZWN0IEZpbGVcIjtcclxuICAgICAgICB2YXIgd2lkdGggPSBmbG93TW9kZWwud2lkdGggKyBcInB4XCI7XHJcbiAgICAgICAgdmFyIGhlaWdodD1mbG93TW9kZWwuaGVpZ2h0ICsgXCJweFwiO1xyXG5cclxuICAgICAgICB2YXIgc3R5bGUgOiBhbnkgPSB7fTtcclxuICAgICAgICBzdHlsZS53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgIHN0eWxlLmhlaWdodCA9IGhlaWdodDtcclxuXHJcbiAgICAgICAgaWYoZmxvd01vZGVsLmlzRWRpdGFibGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmaWxlUGljayA9IHRoaXMucGlja0ZpbGUuYmluZCh0aGlzKTtcclxuICAgICAgICAgICAgdmFyIGNsZWFyQnV0dG9uID0gPHNwYW4gY2xhc3NOYW1lPVwiZ2x5cGhpY29uIGdseXBoaWNvbi1yZW1vdmUgZmlsZS1ib3gtaGVhZGVyLWJ1dHRvblwiIG9uQ2xpY2s9e3RoaXMuY2xlYXJGaWxlLmJpbmQodGhpcyl9Pjwvc3Bhbj47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gPGRpdiBjbGFzc05hbWU9XCJmaWxlLWJveFwiIHN0eWxlPXtzdHlsZX0gPlxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1maWxlLWJveC1oZWFkZXJcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmaWxlLWJveC1oZWFkZXItbGVmdFwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiZmlsZS1ib3gtaGVhZGVyLXRpdGxlXCI+e2NhcHRpb259PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmaWxlLWJveC1oZWFkZXItcmlnaHRcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtjbGVhckJ1dHRvbn1cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1maWxlLWJveC1ib2R5XCIgb25DbGljaz17ZmlsZVBpY2t9PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiByZWY9XCJmbmFtZVwiIGNsYXNzTmFtZT1cImZpbGUtbmFtZVwiPnt0aGlzLnNlbGVjdGVkSXRlbX08L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCByZWY9XCJmaWxlXCIgdHlwZT1cImZpbGVcIiBjbGFzc05hbWU9XCJmaWxlLWZpbGVcIiBvbkNoYW5nZT17dGhpcy5maWxlU2VsZWN0ZWQuYmluZCh0aGlzKX0+PC9pbnB1dD5cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJGaWxlKClcclxuICAgIHtcclxuICAgICAgICB2YXIgZmlsZSA6IGFueTtcclxuICAgICAgICBmaWxlID0gdGhpcy5yZWZzLmZpbGU7XHJcblxyXG4gICAgfVxyXG4gICAgcGlja0ZpbGUoKVxyXG4gICAge1xyXG4gICAgICAgIHZhciBmaWxlIDogYW55O1xyXG4gICAgICAgIGZpbGUgPSB0aGlzLnJlZnMuZmlsZTtcclxuICAgICAgICBmaWxlLmNsaWNrKCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZpbGVTZWxlY3RlZCgpXHJcbiAgICB7XHJcbiAgICAgICAgdmFyIGZpbGUgOiBhbnk7XHJcbiAgICAgICAgZmlsZSA9IHRoaXMucmVmcy5maWxlO1xyXG5cclxuICAgICAgICBpZihmaWxlLmZpbGVzICYmIGZpbGUuZmlsZXMubGVuZ3RoID4gMClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGNvbnN0IGZsb3dNb2RlbCA9IG1hbnl3aG8ubW9kZWwuZ2V0Q29tcG9uZW50KHRoaXMuY29tcG9uZW50SWQsICAgdGhpcy5mbG93S2V5KTtcclxuICAgICAgICAgICAgY29uc3QgZmxvd1N0YXRlID0gbWFueXdoby5zdGF0ZS5nZXRDb21wb25lbnQodGhpcy5jb21wb25lbnRJZCwgICB0aGlzLmZsb3dLZXkpO1xyXG4gICAgICAgICAgICBjb25zdCBhYSA9IHRoaXM7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSA6IGFueSkgXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBmaWxlRGF0YSA9IGJ0b2EoZS50YXJnZXQucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIGZsb3dTdGF0ZS5jb250ZW50VmFsdWUgPSBmaWxlRGF0YTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEl0ZW0gPSBmaWxlLmZpbGVzWzBdLm5hbWU7XHJcbiAgICAgICAgICAgIHRoaXMuZm9yY2VVcGRhdGUoKTtcclxuICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0JpbmFyeVN0cmluZyhmaWxlLmZpbGVzWzBdKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxubWFueXdoby5jb21wb25lbnQucmVnaXN0ZXIoJ1RleHRGaWxlUGlja2VyJywgVGV4dEZpbGVQaWNrZXIpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgVGV4dEZpbGVQaWNrZXI7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vc3JjL1RleHRGaWxlUGlja2VyLnRzeCJdLCJzb3VyY2VSb290IjoiIn0=